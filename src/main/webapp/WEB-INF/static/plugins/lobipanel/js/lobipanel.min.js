Math.randomString=function(t){for(var i="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)i+=e.charAt(Math.floor(Math.random()*e.length));return i},String.prototype.getCss=function(){for(var t={},i=this.valueOf().split(";"),e=0;e<i.length;e++)if(i[e]=$.trim(i[e]),i[e]){var n=i[e].split(":");t[$.trim(n[0])]=$.trim(n[1])}return t},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})},String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},Number.prototype.isBetween=function(t,i,e){if(e){if(this.valueOf()<=i&&this.valueOf()>=t)return!0}else if(this.valueOf()<i&&this.valueOf()>t)return!0;return!1},$.fn.insertAt=function(t,i){var e=i;if("string"==typeof i&&(e=$(i)),0==(t=Math.min(e.children().length,t)))return e.prepend(this),this;var n=this.data("index");t&&!isNaN(t)||(t=e.children().length-1),this.attr("data-index",t);var a=e.children().eq(t-1);return a.length?a.after(this):e.append(this),e.children().each(function(i,e){var a=$(e);n<t&&i>n&&i<=t?a.attr("data-index",parseInt(a.data("data-index"),10)-1):n>=t&&i>t&&i<=n&&a.attr("data-index",parseInt(a.attr("data-index"),10)+1)}),this},$.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",!1)},$.fn.enableSelection=function(){return this.removeAttr("unselectable").css("user-select","initial").off("selectstart")},$(function(){var STORAGE_PREFIX="lobipanel_",StorageLocal=function(){this.saveChildPositions=function(t,i){void 0!==i&&localStorage.setItem(STORAGE_PREFIX+"parent_"+t,JSON.stringify(i))},this.savePanelParams=function(t,i){localStorage.setItem(STORAGE_PREFIX+t,JSON.stringify(i))},this.getAllPanelPositions=function(){var t=[];for(var i in localStorage)if(0===i.indexOf(STORAGE_PREFIX+"parent_")){var e=i.replace(STORAGE_PREFIX+"parent_","");$(".lobipanel-parent-sortable[data-inner-id="+e+"]").length&&(t[e]=JSON.parse(localStorage[i]))}return t},this.getPanelStorage=function(t){var i=localStorage.getItem(STORAGE_PREFIX+t);return JSON.parse(i||null)||{}}},LobiPanel=function(t,i){this.hasRandomId=!1,this.storage={},this.$el=t,this.$el.data("inner-id")||(this.hasRandomId=!0,this.$el.attr("data-inner-id",Math.randomString(10))),this.innerId=this.$el.data("inner-id"),this.$options=this._processInput(i),this.$heading=this.$el.find(">.panel-heading"),this.$body=this.$el.find(">.panel-body"),this._init(),this.$el.css("display","none"),this._applyState(this.$options.state,this.$options.stateParams),this.$el.css("display","block"),this._triggerEvent("init")};LobiPanel.prototype={_processInput:function(t){t||(t={}),this.storageObject=t.storageObject||new StorageLocal,this.hasRandomId||(this.storage=this.storageObject.getPanelStorage(this.innerId));var i=this._getOptionsFromAttributes();t=$.extend({},$.fn.lobiPanel.DEFAULTS,this.storage,t,i);for(var e=["unpin","reload","expand","minimize","close","editTitle"],n=0;n<e.length;n++){var a=e[n];"object"==typeof t[a]&&(t[a]=$.extend({},$.fn.lobiPanel.DEFAULTS[a],t[a],i[a]))}return t},_init:function(){this.$el.addClass("lobipanel"),this.$heading.append(this._generateControls());var t=this.$el.parent();this._appendInnerIdToParent(t,this.innerId),this._enableSorting(),this._onToggleIconsBtnClick(),this._enableResponsiveness(),this._setBodyHeight(),this.$options.autoload&&this.load();var i="calc(100% - "+this.$heading.find(".dropdown-menu").children().length*this.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";this.$heading.find(".panel-title").css("max-width",i),this.getParam("panelTitle")&&this.$heading.find(".panel-title").html(this.getParam("panelTitle"));var e=this.getParam("panelStyle");e&&this.applyStyle(e.bg,e.text)},isPanelInit:function(){return this.$el.hasClass("lobipanel")&&this.$el.data("inner-id")},isPinned:function(){return!this.$el.hasClass("panel-unpin")},pin:function(){this.disableResize(),this.disableDrag(),this._offPanelClick(),this.$el.removeClass("panel-unpin").attr("old-style",this.$el.attr("style")).css("position","relative");var t=["position","z-index","left","top","width","height"];for(var i in t)this.$el.css(t[i],"");return this.$body.css({width:"",height:""}),this._setBodyHeight(),this._insertInParent(),this._enableSorting(),this},unpin:function(){if(this.$el.hasClass("panel-collapsed"))return this;if(this._disableSorting(),this.$el.attr("old-style"))this.$el.attr("style",this.$el.attr("old-style"));else{var t=this.$el.width(),i=this.$el.height(),e=Math.max(0,($(window).width()-this.$el.outerWidth())/2),n=Math.max(0,$(document).scrollTop()+($(window).height()-this.$el.outerHeight())/2);this.$el.css({left:e,top:n,width:t,height:i})}var a=this._getMaxZIndex();this.$el.css("z-index",a["z-index"]+1),this._onPanelClick(),this.$el.addClass("panel-unpin"),$("body").append(this.$el);var o=this._getAvailableWidth(this.$el.width()),s=this._getAvailableHeight(this.$el.height());this.$el.css({position:"absolute",width:o,height:s});var l=this._calculateBodyHeight(s),r=this._calculateBodyWidth(o);return this.$body.css({width:r,height:l}),this.$options.draggable&&this.enableDrag(),"none"!==this.$options.resize&&this.enableResize(),this},togglePin:function(){return this.isPinned()?this.unpin():this.pin(),this},isMinimized:function(){return this.$el.hasClass("panel-minimized")||this.$el.hasClass("panel-collapsed")},minimize:function(){var t=this;if(t._triggerEvent("beforeMinimize"),t.isMinimized())return t;if(t.isPinned())t.$body.slideUp(),t.$el.find(".panel-footer").slideUp(),t.$el.addClass("panel-collapsed"),t._saveState("collapsed"),t._changeClassOfControl(t.$heading.find('[data-func="minimize"]'));else{t.disableTooltips();var i,e,n=t._getFooterForMinimizedPanels(),a=n.find(">*");if(e=n.offset().top,0===a.length)i=n.offset().left;else{var o=$(a[a.length-1]);i=o.offset().left+o.width()}t.$el.hasClass("panel-expanded")||t.$el.attr("old-style",t.$el.attr("style")),t.$el.animate({left:i,top:e,width:200,height:n.height()},100,function(){t.$el.hasClass("panel-expanded")&&(t.$el.removeClass("panel-expanded"),t.$el.find(".panel-heading [data-func=expand] ."+LobiPanel.PRIVATE_OPTIONS.iconClass).removeClass(t.$options.expand.icon2).addClass(t.$options.expand.icon)),t.$el.addClass("panel-minimized"),t.$el.removeAttr("style"),t.disableDrag(),t.disableResize(),t._expandOnHeaderClick(),n.append(t.$el),$("body").addClass("lobipanel-minimized");var i="calc(100% - "+t.$heading.find(".dropdown-menu li>a:visible").length*t.$heading.find(".dropdown-menu li>a:visible").first().outerWidth()+"px)";t.$heading.find(".panel-title").css("max-width",i),t._saveState("minimized"),t._triggerEvent("onMinimize")})}return t},maximize:function(){var t=this;if(t._triggerEvent("beforeMaximize"),!t.isMinimized())return t;if(t.isPinned())t.$body.slideDown(),t.$el.find(".panel-footer").slideDown(),t.$el.removeClass("panel-collapsed"),t._saveState("pinned"),t._changeClassOfControl(t.$heading.find('[data-func="minimize"]')),t._triggerEvent("onMaximize");else{t.enableTooltips();var i=t.$el.attr("old-style").getCss();t.$el.css({position:i.position||"fixed","z-index":i["z-index"],left:t.$el.offset().left,top:t.$el.offset().top,width:t.$el.width(),height:t.$el.height()}),$("body").append(t.$el),delete i.position,delete i["z-index"],t.$el.animate(i,100,function(){t.$el.css("position",""),t.$el.removeClass("panel-minimized"),t.$el.removeAttr("old-style"),t.$options.draggable&&t.enableDrag(),t.enableResize(),t._removeExpandOnHeaderClick();var i=t._getFooterForMinimizedPanels();0===i.children().length&&i.remove(),$("body").removeClass("lobipanel-minimized").addClass("lobipanel-minimized");var e="calc(100% - "+t.$heading.find(".dropdown-menu li").length*t.$heading.find(".dropdown-menu li").first().outerWidth()+"px)";t.$heading.find(".panel-title").css("max-width",e),t._updateUnpinnedState(),t._triggerEvent("onMaximize")})}return t},toggleMinimize:function(){return this.isMinimized()?this.maximize():this.minimize(),this},isOnFullScreen:function(){return this.$el.hasClass("panel-expanded")},toFullScreen:function(){var t=this;if(t._triggerEvent("beforeFullScreen"),t.$el.hasClass("panel-collapsed"))return t;t.$el.attr("data-index",t.$el.index()),t._changeClassOfControl(t.$heading.find('[data-func="expand"]')),t.$el.css("position","fixed");var i=t._getMaxZIndex();if(t.isPinned()||t.isMinimized()){t.enableTooltips(),t.$el.css({"z-index":i["z-index"]+1,left:t.$el.offset().left,top:t.$el.offset().top-$(window).scrollTop(),width:t.$el.width(),height:t.$el.height()}),$("body").append(t.$el);var e=t._getFooterForMinimizedPanels();0===e.children().length&&e.remove()}else t.$body.css({width:"",height:""}),t._setBodyHeight();t.isMinimized()?(t.$el.removeClass("panel-minimized"),t._removeExpandOnHeaderClick()):(t.$el.attr("old-style",t.$el.attr("style")),t.disableResize());var n=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass).outerHeight()||0;return t.$el.animate({width:$(window).width(),height:$(window).height()-n,left:0,top:0},t.$options.expandAnimation,function(){t.$el.css({width:"",height:"",right:0,bottom:n}),t.$el.addClass("panel-expanded"),$("body").css("overflow","hidden"),t.$body.css({width:t._calculateBodyWidth(t.$el.width()),height:t._calculateBodyHeight(t.$el.height())}),t.disableDrag(),t.isPinned()&&t._disableSorting(),t._saveState("fullscreen"),t._triggerEvent("onFullScreen")}),t},toSmallSize:function(){var t=this;t._triggerEvent("beforeSmallSize"),t._changeClassOfControl(t.$heading.find('[data-func="expand"]'));var i=t.$el.attr("old-style").getCss(),e=["position","z-index","left","top","width","height"];return t.$el.animate({position:"absolute",left:i.left,top:i.top,width:i.width,height:i.height,right:i.right,bottom:i.bottom},t.$options.collapseAnimation,function(){if(t.$el.removeAttr("old-style"),t.$el.hasClass("panel-unpin"))t.$options.draggable&&t.enableDrag(),t.enableResize();else{for(var i in e)t.$el.css(e[i],"");t._insertInParent(),t._enableSorting()}t.$el.removeClass("panel-expanded"),$("body").css("overflow","auto");var n="",a="";t.isPinned()?"auto"!==t.$options.bodyHeight&&(a=t.$options.bodyHeight):(n=t._calculateBodyWidth(t.getWidth()),a=t._calculateBodyHeight(t.getHeight())),t.isPinned()?t._saveState("pinned"):t._updateUnpinnedState(),t.$body.css({width:n,height:a}),t._triggerEvent("onSmallSize")}),t},toggleSize:function(){return this.isOnFullScreen()?this.toSmallSize():this.toFullScreen(),this},close:function(t){var i=this;t=void 0===t?100:t;return i._triggerEvent("beforeClose"),i.$el.hide(t,function(){i.isOnFullScreen()&&$("body").css("overflow","auto"),i._triggerEvent("onClose"),i.$el.remove();var t=i._getFooterForMinimizedPanels();0===t.children().length&&t.remove()}),i},setPosition:function(t,i,e){e=void 0===e?100:e;return this.isPinned()?this:(this.$el.animate({left:t,top:i},e),this)},setWidth:function(t,i){i=void 0===i?100:i;if(this.isPinned())return this;var e=this._calculateBodyWidth(t);return this.$el.animate({width:t},i),this.$body.animate({width:e},i),this},setHeight:function(t,i){i=void 0===i?100:i;if(this.isPinned())return this;var e=this._calculateBodyHeight(t);return this.$el.animate({height:t},i),this.$body.animate({height:e},i),this},setSize:function(t,i,e){e=void 0===e?100:e;if(this.isPinned())return this;var n=this._calculateBodyHeight(i),a=this._calculateBodyWidth(t);return this.$el.animate({height:i,width:t},e),this.$body.animate({height:n,width:a},e),this},getPosition:function(){var t=this.$el.offset();return{x:t.left,y:t.top}},getWidth:function(){return this.$el.width()},getHeight:function(){return this.$el.height()},bringToFront:function(){this._triggerEvent("beforeToFront");var t=this._getMaxZIndex();return t.id===this.$el.data("inner-id")?this:(this.$el.css("z-index",t["z-index"]+1),this._triggerEvent("onToFront"),this)},enableDrag:function(){var t=this;return t.$el.draggable({handle:".panel-heading",containment:t.$options.constrain,start:function(){t.$el.css("position","absolute")},stop:function(){t.$el.css("position",""),t._updateUnpinnedState()}}),t},disableDrag:function(){return this.$el.hasClass("ui-draggable")&&this.$el.draggable("destroy"),this},enableResize:function(){var t=this,i=!1;return"vertical"===t.$options.resize?i="n, s":"horizontal"===t.$options.resize?i="e, w":"both"===t.$options.resize&&(i="all"),i?(t.$el.resizable({minWidth:t.$options.minWidth,maxWidth:t.$options.maxWidth,minHeight:t.$options.minHeight,maxHeight:t.$options.maxHeight,handles:i,start:function(){t.$el.disableSelection(),t._triggerEvent("resizeStart")},stop:function(){t.$el.enableSelection(),t._triggerEvent("resizeStop")},resize:function(){var i=t._calculateBodyHeight(t.$el.height()),e=t._calculateBodyWidth(t.$el.width());t.$body.css({width:e,height:i}),t._updateUnpinnedState(),t._triggerEvent("onResize")}}),t):t},disableResize:function(){return this.$el.hasClass("ui-resizable")&&this.$el.resizable("destroy"),this},startLoading:function(){var t=this._generateWindow8Spinner();this.$el.append(t);return t.find(".spinner").css("margin-top",50),this},stopLoading:function(){return this.$el.find(".spinner-wrapper").remove(),this},setLoadUrl:function(t){return this.$options.loadUrl=t,this},load:function(t){var i=this;"string"==typeof(t=t||{})&&(t={url:t});var e=t.url||i.$options.loadUrl,n=t.data||{},a=t.callback||null;return e?(i._triggerEvent("beforeLoad"),i.startLoading(),i.$body.load(e,n,function(t,e,n){a&&"function"==typeof a&&i.callback(t,e,n),i.stopLoading(),i._triggerEvent("loaded",t,e,n)}),i):i},destroy:function(){return this.disableDrag(),this.disableResize(),this.$options.sortable=!1,this._enableSorting(),this._removeInnerIdFromParent(this.innerId),this.$el.removeClass("lobipanel").removeAttr("data-inner-id").removeAttr("data-index").removeData("lobiPanel"),this.$heading.find(".dropdown").remove(),this.$el},startTitleEditing:function(){var t=this,i=t.$heading.find(".panel-title").text().trim(),e=$('<input value="'+i+'"/>');return e.on("keydown",function(i){13===i.which?t.finishTitleEditing():27===i.which&&t.cancelTitleEditing()}),t.$heading.find(".panel-title").data("old-title",i).html("").append(e),e[0].focus(),e[0].select(),t._changeClassOfControl(t.$heading.find('[data-func="editTitle"]')),t},isTitleEditing:function(){return this.$heading.find(".panel-title input").length>0},cancelTitleEditing:function(){var t=this.$heading.find(".panel-title");return t.html(t.data("old-title")).find("input").remove(),this._changeClassOfControl(this.$heading.find('[data-func="editTitle"]')),this},finishTitleEditing:function(){var t=this.$heading.find("input");return!1===this._triggerEvent("beforeTitleChange",t.val())?this:(this.saveParam("panelTitle",t.val()),this.$heading.find(".panel-title").html(t.val()),t.remove(),this._changeClassOfControl(this.$heading.find('[data-func="editTitle"]')),this._triggerEvent("onTitleChange",t.val()),this)},enableTooltips:function(){if($(window).width()<768)return this;var t=this.$heading.find(".dropdown-menu>li>a");return t.each(function(t,i){var e=$(i);e.attr("data-toggle","tooltip").attr("data-title",e.data("tooltip")).attr("data-placement","bottom")}),t.each(function(t,i){$(i).tooltip({container:"body",template:'<div class="tooltip lobipanel-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})}),this},disableTooltips:function(){return this.$heading.find(".dropdown-menu>li>a").each(function(t,i){$(i).data("bs.tooltip")&&$(i).tooltip("destroy")}),this},_generateControls:function(){var t=this._generateDropdown(),i=t.find(".dropdown-menu");return!1!==this.$options.editTitle&&i.append(this._generateEditTitle()),!1!==this.$options.unpin&&i.append(this._generateUnpin()),!1!==this.$options.reload&&i.append(this._generateReload()),!1!==this.$options.minimize&&i.append(this._generateMinimize()),!1!==this.$options.expand&&i.append(this._generateExpand()),!1!==this.$options.changeStyle&&i.append(this._generateChangeStyle()),!1!==this.$options.close&&i.append(this._generateClose()),i.find(">li>a").on("click",function(t){t.preventDefault(),t.stopPropagation()}),t},_generateDropdown:function(){return $('<div class="dropdown"'+(this.$options.forAngularJs?" uib-dropdown":"")+"></div>").append('<ul class="dropdown-menu dropdown-menu-right"'+(this.$options.forAngularJs?" uib-dropdown-menu":"")+"></ul>").append('<div class="dropdown-toggle"'+(this.$options.forAngularJs?" uib-dropdown-toggle":' data-toggle="dropdown"')+'><span class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+this.$options.toggleIcon+'"></div>')},_generateEditTitle:function(){var t=this.$options.editTitle,i=$('<a data-func="editTitle"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachEditTitleClickListener(i),$("<li></li>").append(i)},_attachEditTitleClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(e){e.stopPropagation(),i.hideTooltip(t),i.isTitleEditing()?i.finishTitleEditing():i.startTitleEditing()})},hideTooltip:function(t){return t.data("bs.tooltip")&&t.tooltip("hide"),this},_generateUnpin:function(){var t=this.$options.unpin,i=$('<a data-func="unpin"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachUnpinClickListener(i),$("<li></li>").append(i)},_attachUnpinClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(){i.hideTooltip(t),i.doTogglePin()})},_generateReload:function(){var t=this.$options.reload,i=$('<a data-func="reload"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachReloadClickListener(i),$("<li></li>").append(i)},_attachReloadClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(){i.hideTooltip(t),i.load()})},_generateMinimize:function(){var t=this.$options.minimize,i=$('<a data-func="minimize"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachMinimizeClickListener(i),$("<li></li>").append(i)},_attachMinimizeClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(e){e.stopPropagation(),i.hideTooltip(t),i.toggleMinimize()})},_generateExpand:function(){var t=this.$options.expand,i=$('<a data-func="expand"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachExpandClickListener(i),$("<li></li>").append(i)},_generateChangeStyle:function(){var t=this,i=t.$options.changeStyle,e=$('<a data-func="changeStyle"></a>');e.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+i.icon+'"></i>'),i.tooltip&&"string"==typeof i.tooltip&&(e.append('<span class="control-title">'+i.tooltip+"</span>"),e.attr("data-tooltip",i.tooltip));var n=$('<li class="style-change-item"></li>').append(e),a=$("<div>",{class:"style-list"}).appendTo(n);if(t.$options.styles)for(var o=0;o<t.$options.styles.length;o++){var s=t.$options.styles[o];a.append('<div class="style-item style-primary" style="background-color: '+s.bg+'" data-bg="'+s.bg+'" data-text="'+s.text+'"></div>')}return a.find(".style-item").on("click",function(){var i=$(this);t.saveParam("panelStyle",{bg:i.data("bg"),text:i.data("text")}),t.applyStyle(i.data("bg"),i.data("text")),a.removeClass("opened")}),e.on("click",function(){$(this).closest(".style-change-item").find(".style-list").toggleClass("opened")}),n},applyStyle:function(t,i){this.$heading.css("background-color",t),this.$heading.css("border-color",t),this.$heading.css("color",i),this.$el.css("border-color",t)},_createDropdownForStyleChange:function(){for(var t=this,i=$("<div>",{class:"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown",class:"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),e=$("<div>",{class:"dropdown-menu dropdown-menu-right"}).appendTo(i),n=0;n<0;n++){t.$globalOptions.listStyles[n];$('<div class="primary"></div>').on("mousedown",function(t){t.stopPropagation()}).click(function(){for(var i=t.$el[0].className.split(" "),e=null,n=0;n<i.length;n++)t.$globalOptions.listStyles.indexOf(i[n])>-1&&(e=i[n]);t.$el.removeClass(t.$globalOptions.listStyles.join(" ")).addClass(this.className),t._triggerEvent("styleChange",[t,e,this.className])}).appendTo(e)}return i},_attachExpandClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(e){e.stopPropagation(),i.hideTooltip(t),i.toggleSize()})},_generateClose:function(){var t=this.$options.close,i=$('<a data-func="close"></a>');return i.append('<i class="'+LobiPanel.PRIVATE_OPTIONS.iconClass+" "+t.icon+'"></i>'),t.tooltip&&"string"==typeof t.tooltip&&(i.append('<span class="control-title">'+t.tooltip+"</span>"),i.attr("data-tooltip",t.tooltip)),this._attachCloseClickListener(i),$("<li></li>").append(i)},_attachCloseClickListener:function(t){var i=this;t.on("mousedown",function(t){t.stopPropagation()}),t.on("click",function(e){e.stopPropagation(),i.hideTooltip(t),i.close()})},_getMaxZIndex:function(){var t,i,e,n=$(".lobipanel.panel-unpin:not(.panel-minimized.panel-expanded)");if(0===n.length)return{id:"","z-index":LobiPanel.PRIVATE_OPTIONS.initialZIndex};t=$(n[0]).attr("style");var a=$(n[0]).data("inner-id");i=t?t.getCss()["z-index"]:LobiPanel.PRIVATE_OPTIONS.initialZIndex;for(var o=1;o<n.length;o++)(e=(t=$(n[o]).attr("style"))?t.getCss()["z-index"]:0)>i&&(a=$(n[o]).data("inner-id"),i=e);return{id:a,"z-index":parseInt(i,10)}},_onPanelClick:function(){var t=this;t.$el.on("mousedown.lobiPanel",function(){if(t.isPinned()||t.isMinimized()||t.isOnFullScreen())return!1;t.bringToFront()})},_offPanelClick:function(){this.$el.off("mousedown.lobiPanel")},_changeClassOfControl:function(t){t=$(t);var i=this.$options[t.attr("data-func")];i.icon&&t.find("."+LobiPanel.PRIVATE_OPTIONS.iconClass).toggleClass(i.icon).toggleClass(i.icon2)},_getFooterForMinimizedPanels:function(){var t=$("."+LobiPanel.PRIVATE_OPTIONS.toolbarClass);return 0===t.length&&(t=$('<div class="'+LobiPanel.PRIVATE_OPTIONS.toolbarClass+'"></div>'),$("body").append(t)),t},_expandOnHeaderClick:function(){var t=this;t.$heading.on("click.lobiPanel",function(){t.maximize(),t.bringToFront()})},_removeExpandOnHeaderClick:function(){this.$heading.off("click.lobiPanel")},_getAvailableWidth:function(t){return this.$options.maxWidth&&(t=Math.min(t,this.$options.maxWidth)),this.$options.minWidth&&(t=Math.max(t,this.$options.minWidth)),t},_getAvailableHeight:function(t){return this.$options.maxHeight&&(t=Math.min(t,this.$options.maxHeight)),this.$options.minHeight&&(t=Math.max(t,this.$options.minHeight)),t},_calculateBodyHeight:function(t){return t-this.$heading.outerHeight()-this.$el.find(".panel-footer").outerHeight()},_calculateBodyWidth:function(t){return t-2},_appendInnerIdToParent:function(t,i){if(void 0===t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr))t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,i);else{if(t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).indexOf(i)>-1)return;var e=t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr);t.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,e+" "+i)}this.$el.attr("data-index",this.$el.index())},_insertInParent:function(){var t=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+this.innerId+"]");this.$el.insertAt(this.$el.attr("data-index"),t)},_generateWindow8Spinner:function(){var t=['<div class="spinner spinner-windows8">','<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>",'<div class="wBall">','<div class="wInnerBall">',"</div>","</div>","</div>"].join("");return $('<div class="spinner-wrapper">'+t+"</div>")},_enableSorting:function(){var t=this,i=t.$el.parent();i.hasClass("ui-sortable")&&i.sortable("destroy"),t.$options.sortable?(t.$el.addClass("lobipanel-sortable"),i.addClass("lobipanel-parent-sortable")):t.$el.removeClass("lobipanel-sortable"),i.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:!0,opacity:.7,revert:300,update:function(i,e){t.savepanelPositions();var n=e.item.data("inner-id");t._removeInnerIdFromParent(n),t._appendInnerIdToParent(e.item.parent(),n),t._triggerEvent("dragged")}})},savepanelPositions:function(){var t=this;$(".lobipanel-parent-sortable").each(function(i,e){var n=$(e),a=n.data("inner-id");if(a){var o={};n.find(".lobipanel").each(function(t,i){var e=$(i);o[e.data("inner-id")]=t}),t.storageObject.saveChildPositions(a,o)}else console.error("Panel does not have parent id ",n)})},_disableSorting:function(){var t=this.$el.parent();t.hasClass("ui-sortable")&&t.sortable("destroy")},_removeInnerIdFromParent:function(t){var i=$("["+LobiPanel.PRIVATE_OPTIONS.parentAttr+"~="+t+"]");if(i.length){var e=i.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr).replace(t,"").trim().replace(/\s{2,}/g," ");i.attr(LobiPanel.PRIVATE_OPTIONS.parentAttr,e)}},_onToggleIconsBtnClick:function(){var t=this;t.$heading.find(".toggle-controls").on("click.lobiPanel",function(){t.$el.toggleClass("controls-expanded")})},_adjustForScreenSize:function(){this.disableTooltips(),$(window).width()>768&&this.$options.tooltips&&this.enableTooltips(),this.isOnFullScreen()&&this.$body.css({width:this._calculateBodyWidth(this.$el.width()),height:this._calculateBodyHeight(this.$el.height())})},_enableResponsiveness:function(){var t=this;t._adjustForScreenSize(),$(window).on("resize.lobiPanel",function(){t._adjustForScreenSize()})},_setBodyHeight:function(){"auto"!==this.$options.bodyHeight&&this.$body.css({height:this.$options.bodyHeight,overflow:"auto"})},_getOptionsFromAttributes:function(){var me=this,$el=me.$el,options={};for(var key in $.fn.lobiPanel.DEFAULTS){var k=key.toDash(),val=$el.data(k);void 0!==val&&("object"!=typeof $.fn.lobiPanel.DEFAULTS[key]?options[key]=val:options[key]=eval("("+val+")"))}return options},_saveState:function(t,i){!this.hasRandomId&&this.$options.stateful&&(this.storage.state=t,i&&(this.storage.stateParams=i),this._saveLocalStorage(this.storage))},getParam:function(t,i){return this.storage[t]},saveParam:function(t,i){this.storage[t]=i,this._saveLocalStorage(this.storage)},_saveLocalStorage:function(t){this.storageObject.savePanelParams(this.innerId,t)},_applyState:function(t,i){switch(t){case"pinned":if(!this.hasRandomId){var e=this.storageObject.getAllPanelPositions();for(var n in e){var a=e[n],o=n,s=$(".lobipanel-parent-sortable[data-inner-id="+o+"]");for(var l in a){var r=$("[data-inner-id="+l+"]");this._removeInnerIdFromParent(r.data("inner-id")),this._appendInnerIdToParent(s,r.data("inner-id")),r.hasClass("panel-unpin")||r.hasClass("panel-expanded")||r.insertAt(a[l],s)}}}break;case"unpinned":this.unpin(),this.setPosition(i.left,i.top,0),this.setSize(i.width,i.height,0);break;case"minimized":this.unpin(),this.minimize();break;case"collapsed":this.minimize();break;case"fullscreen":this.toFullScreen()}},_applyIndex:function(t){null!==t&&this.$el.insertAt(t,this.$el.parent())},_triggerEvent:function(t){var i=Array.prototype.slice.call(arguments,1);return i.unshift(this),this.$el.trigger(t+".lobiPanel",i),!this.$options[t]||"function"!=typeof this.$options[t]||this.$options[t].apply(this,i)},doPin:function(){return!1!==this._triggerEvent("beforePin")&&(this.pin(),this._saveState("pinned"),this._triggerEvent("onPin")),this},doUnpin:function(){return!1!==this._triggerEvent("beforeUnpin")&&(this.unpin(),this._updateUnpinnedState(),this._triggerEvent("onUnpin")),this},doTogglePin:function(){return this.isPinned()?this.doUnpin():this.doPin(),this},_updateUnpinnedState:function(){this._saveState("unpinned",this.getAlignment())},getAlignment:function(){return{top:this.$el.css("top"),left:this.$el.css("left"),width:this.$el.css("width"),height:this.$el.css("height")}}},$.fn.lobiPanel=function(t){var i=arguments,e=null;return this.each(function(){var n=$(this),a=n.data("lobiPanel"),o="object"==typeof t&&t;a||n.data("lobiPanel",a=new LobiPanel(n,o)),"string"==typeof t&&(i=Array.prototype.slice.call(i,1),e=a[t].apply(a,i))}),e},$.fn.lobiPanelParent=function(t){return this.each(function(t,i){var e=$(i);e.hasClass("ui-sortable")||e.sortable({connectWith:".lobipanel-parent-sortable",items:".lobipanel-sortable",handle:".panel-heading",cursor:"move",placeholder:"lobipanel-placeholder",forcePlaceholderSize:!0,opacity:.7,revert:300,update:function(t,i){console.log(i)}})}),this},LobiPanel.PRIVATE_OPTIONS={parentAttr:"data-lobipanel-child-inner-id",toolbarClass:"lobipanel-minimized-toolbar",initialZIndex:1e4,iconClass:"panel-control-icon"},$.fn.lobiPanel.DEFAULTS={draggable:!0,sortable:!1,connectWith:".ui-sortable",resize:"both",minWidth:200,minHeight:100,maxWidth:1200,maxHeight:700,loadUrl:"",autoload:!0,bodyHeight:"auto",tooltips:!0,forAngularJs:!1,toggleIcon:"glyphicon glyphicon-cog",expandAnimation:100,collapseAnimation:100,state:"pinned",initialIndex:null,stateful:!1,constrain:"document",unpin:{icon:"glyphicon glyphicon-move",tooltip:"Unpin"},reload:{icon:"glyphicon glyphicon-refresh",tooltip:"Reload"},minimize:{icon:"glyphicon glyphicon-minus",icon2:"glyphicon glyphicon-plus",tooltip:"Minimize"},expand:{icon:"glyphicon glyphicon-resize-full",icon2:"glyphicon glyphicon-resize-small",tooltip:"Fullscreen"},changeStyle:{icon:"glyphicon glyphicon-th",tooltip:"Style"},close:{icon:"glyphicon glyphicon-remove",tooltip:"Close"},editTitle:{icon:"glyphicon glyphicon-pencil",icon2:"glyphicon glyphicon-floppy-disk",tooltip:"Edit title"},styles:[{bg:"#d9534f",text:"#FFF"},{bg:"#f0ad4e",text:"#FFF"},{bg:"#337ab7",text:"#FFF"},{bg:"#5bc0de",text:"#FFF"},{bg:"#4753e4",text:"#FFF"},{bg:"#9e4aea",text:"#FFF"}],storageObject:null,beforeTitleChange:null},$(".lobipanel").lobiPanel();var $parent=$(".lobipanel-parent-sortable");$parent.lobiPanelParent()});